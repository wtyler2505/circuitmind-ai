# Component Reference

## 1. DiagramCanvas.tsx
This is the interactive SVG renderer for the wiring diagrams.

### Logic Flow
1.  **Auto-Layout**: On mount or update, it calculates `x,y` coordinates for every component.
    - **MCUs**: Center column.
    - **Power**: Left column.
    - **Sensors/Other**: Right column.
2.  **Smart Routing**: Wires are not straight lines. See `getSmartPath`. It uses Cubic Bezier curves (`C`) but falls back to a "Manhattan/Zig-Zag" route (`L`) if components are too close horizontally to prevent visual clutter.
3.  **Pin Matching**: It attempts to map `connections.fromPin` to the component's `pins` array index.
    - **Hallucination Handling**: If the AI hallucinates a pin name that doesn't exist in the component definition, the canvas defaults the wire connection to the **bottom-center** of the component node and renders a **Red Pulsing Dot**.

### Interaction
- **Pan/Zoom**: Implemented via SVG `transform` matrix manipulation.
- **Wire Editing**: Clicking a wire opens a small overlay input at the click coordinates to rename the connection.

## 2. Inventory.tsx
The sidebar manager.
- **Key Feature**: Search filtering.
- **Bug Fix**: The dropdown for "Type" explicitly casts `e.target.value` to `ElectronicComponent['type']` to satisfy TypeScript unions.

## 3. ThreeViewer.tsx
A wrapper around a raw Three.js canvas.

### The "Dangerous" Part
This component accepts a `code` prop (string) generated by Gemini.
- It creates a `new Function('THREE', code)` to execute the string as JavaScript.
- **Security**: This is client-side only. The risk is limited to the user's browser crashing, but XSS is theoretically possible if the prompt is hijacked.
- **Fallback**: Wrapped in `ErrorBoundary.tsx` to catch Three.js context failures without crashing the whole app.

### Lighting Studio
Includes a hidden control panel (click the settings icon) to adjust Ambient and Directional light intensity/color in real-time.

## 4. ComponentEditorModal.tsx
The core interface for component data management and AI collaboration.

### Tabs Structure
1.  **INFO**: Displays the static description and AI-generated "Explanation" of the component. Links to datasheets if available.
2.  **EDIT**: The primary workspace.
    *   **Manual Form**: Standard inputs for Name, Type, Description, Pins, etc.
    *   **AI Auto-Fill**: A button next to the name field triggers `smartFillComponent`. It uses Google Search to find specs based on the name and auto-populates the form fields.
    *   **AI Assistant (Side Panel)**: A togglable chat interface that sits alongside the form. Users can type natural language (e.g., "Add the SPI pins for an Arduino"). The AI (powered by `assistComponentEditor`) returns structured JSON updates which are immediately applied to the React state.
3.  **IMAGE**: Handles image management.
    *   **Upload**: File input for local images.
    *   **AI Generation**: Generates a thumbnail using `gemini-3-pro-image-preview`.
4.  **3D MODEL**: Generates or displays 3D content using `ThreeViewer`.

### State Management
- **Local vs Global**: This modal keeps a local copy of the component state (`editedName`, `editedPins`, etc.).
- **Changes Tracking**: A `hasChanges` boolean tracks diffs between props and local state to enable/disable the "SAVE" button.
- **Rich Chat**: The side panel supports rendering images found by the AI (via Google Search) and "Action Buttons" (e.g., "GENERATE_3D") suggested by the AI.